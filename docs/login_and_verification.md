# 登录管理和人工验证文档

## 知乎平台登录管理

知乎平台采用持久化浏览器上下文来管理登录状态。具体实现方式如下：

1. 使用Playwright的launch_persistent_context方法创建持久化上下文，将用户数据保存在指定目录中
2. 通过检查页面元素判断登录状态，包括用户头像、搜索框等标识
3. 支持扫码登录方式，用户可以在浏览器中手动完成登录操作
4. 登录状态会在后续操作中自动保持，无需重复登录

登录状态检测机制包括多个层次的检查：
- 检查是否已登录（通过用户信息元素）
- 检查是否在登录页面
- 检查是否有扫码登录选项

用户登录后，系统会自动检测登录状态并在后续操作中保持该状态。

## 微信平台人工验证

微信平台通过搜狗搜索实现内容抓取，由于反爬虫机制较为严格，需要人工验证。具体实现方式如下：

1. 在搜索过程中检测是否出现验证码页面
2. 当检测到验证码时，系统会暂停执行并等待人工输入
3. 提供无限等待机制，直到用户完成验证码输入
4. 验证完成后自动继续执行后续操作

人工验证处理机制：
- 自动检测验证码页面（通过URL、标题和内容特征）
- 提供wait_for_manual_verification方法等待用户完成验证
- 支持无超时限制的等待，确保用户有充足时间完成验证
- 验证完成后自动检测并确认验证状态

## 平台差异处理

不同平台采用不同的验证策略：
- 知乎平台：支持登录功能，通过持久化上下文保持登录状态
- 微信平台：需要人工验证码验证，必须显示浏览器窗口
- 通用平台：不需要特殊验证

在ScraperToolkit中，通过get_platform_info方法可以获取各平台的验证需求信息，便于在使用时做出相应处理。

## 最佳实践

1. 对于需要登录的平台，建议在程序启动时就完成登录操作
2. 对于需要人工验证的平台，应明确提示用户需要进行验证操作
3. 合理设置等待时间，给用户充足的验证时间
4. 提供清晰的状态反馈，让用户了解当前操作进度
5. 在程序结束时正确清理浏览器资源，避免资源泄露